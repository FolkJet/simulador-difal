<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Simulador DIFAL</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      background-size: contain;
      background-position: top center;
      background-repeat: no-repeat;
      background-attachment: fixed;
      color: #003366;
    }

    .overlay {
      background-color: rgba(255, 255, 255, 0.88);
      max-width: 600px;
      margin: 0 auto;
      padding: 30px 20px;
      box-sizing: border-box;
      border-radius: 8px;
      min-height: 100vh;
    }

    #tituloPrincipal {
      font-family: Verdana, sans-serif;
      font-size: 18px;
      color: #003366;
      font-weight: 600;
      margin-bottom: 20px;
      text-align: center;
    }

    label, h2, h3 {
      font-family: Verdana, sans-serif;
      font-size: 10px;
      color: #003366;
      font-weight: 600;
      margin-top: 10px;
    }

    input, select, button {
      font-family: Verdana, sans-serif;
      font-size: 10px;
      color: #003366;
      font-weight: 600;
      width: 100%;
      margin: 8px 0 12px 0;
      box-sizing: border-box;
      padding: 5px;
    }

    button {
      cursor: pointer;
    }

    .hidden {
      display: none;
    }

    #mensagemCE {
      background-color: #ffe0e0;
      color: #a00;
      padding: 15px;
      border: 1px solid #a00;
      border-radius: 5px;
      font-family: Verdana, sans-serif;
      font-size: 10px;
      font-weight: 600;
      margin: 20px 0;
    }

    #resultado p {
      margin: 5px 0;
    }
  </style>
</head>
<body>
  <div class="overlay">
    <div id="tituloPrincipal">Simulador DIFAL (Diferencial de Alíquotas)</div>

    <h2>Informe a Unidade da Federação (destino):</h2>
    <select id="ufDestino">
      <option value="">Selecione</option>
      <option value="CE">CE</option>
      <option value="DF">DF</option>
      <option value="GO">GO</option>
      <option value="MG">MG</option>
      <option value="MS">MS</option>
      <option value="MT">MT</option>
      <option value="PR">PR</option>
      <option value="RJ">RJ</option>
      <option value="RS">RS</option>
      <option value="SC">SC</option>
      <option value="SP">SP</option>
    </select>

    <div id="mensagemCE" class="hidden">
      <strong>Atenção:</strong> Procurar o departamento fiscal para simulação do cálculo do DIFAL para o Ceará.
    </div>

    <div id="formCampos" class="hidden">
      <label>Valor da Operação (acrescido do IPI, frete e demais despesas cobradas na N.F):</label>
      <input type="number" id="valorOperacao" step="0.01" />

      <label>Valor do ICMS destacado na NF:</label>
      <input type="number" id="valorICMS" step="0.01" />

      <label>Alíquota Interestadual (%):</label>
      <select id="aliqInterestadual">
        <option value="">Selecione</option>
        <option value="12">12%</option>
        <option value="7">7%</option>
        <option value="4">4%</option>
      </select>

      <button onclick="calcular()">Calcular</button>
    </div>

    <div id="resultado" class="hidden">
      <h3>Resultado:</h3>
      <p id="aliqInternaTexto"></p>
      <p id="diferencaAliqTexto"></p>
      <p id="baseCalculoTexto"></p>
      <p id="valorDIFALTexto"></p>
      <p id="valorFCPTexto"></p>
    </div>
  </div>

  <script>
    const ufInternas = {
      CE: 20, DF: 20, GO: 19, MG: 18, MS: 17,
      MT: 17, PR: 19.5, RJ: 20, RS: 17, SC: 17, SP: 18
    };

    const ufFCP = {
      RJ: 2
    };

    document.getElementById('ufDestino').addEventListener('change', () => {
      const uf = document.getElementById('ufDestino').value;
      const form = document.getElementById('formCampos');
      const msg = document.getElementById('mensagemCE');
      const resultado = document.getElementById('resultado');

      if (uf === 'CE') {
        form.classList.add('hidden');
        msg.classList.remove('hidden');
        resultado.classList.add('hidden');
      } else if (uf !== '') {
        form.classList.remove('hidden');
        msg.classList.add('hidden');
        resultado.classList.add('hidden');
      } else {
        form.classList.add('hidden');
        msg.classList.add('hidden');
        resultado.classList.add('hidden');
      }
    });

    function calcular() {
      const ufDestino = document.getElementById('ufDestino').value;
      const valorOperacao = parseFloat(document.getElementById('valorOperacao').value);
      const valorICMS = parseFloat(document.getElementById('valorICMS').value);
      const aliqInterestadual = parseFloat(document.getElementById('aliqInterestadual').value);
      const aliqInterna = ufInternas[ufDestino];
      const aliqFCP = ufFCP[ufDestino] || 0;

      if (isNaN(valorOperacao) || isNaN(valorICMS) || isNaN(aliqInterestadual)) {
        alert('Preencha todos os campos obrigatórios.');
        return;
      }

      let baseCalculo = 0;
      let difal = 0;
      let fcp = 0;

      if (ufDestino === 'DF') {
        baseCalculo = valorOperacao;
        difal = (baseCalculo * aliqInterna / 100) - (valorOperacao * aliqInterestadual / 100);

      } else if (ufDestino === 'GO') {
        baseCalculo = valorOperacao / (1 - (aliqInterna / 100));
        difal = baseCalculo * ((aliqInterna - aliqInterestadual) / 100);

      } else if (ufDestino === 'RJ') {
        const divisor = Math.round(((1 - aliqInterna / 100) * (1 - aliqFCP / 100)) * 100) / 100;
        baseCalculo = (valorOperacao - valorICMS) / divisor;
        difal = (baseCalculo * aliqInterna / 100) - (valorOperacao * aliqInterestadual / 100);
        fcp = baseCalculo * (aliqFCP / 100);

      } else if (['SP', 'SC', 'RS', 'MT', 'MG', 'PR', 'MS'].includes(ufDestino)) {
        baseCalculo = (valorOperacao - valorICMS) / (1 - (aliqInterna / 100));
        difal = (baseCalculo * aliqInterna / 100) - (valorOperacao * aliqInterestadual / 100);
      }

      const diferencaAliq = aliqInterna - aliqInterestadual;

      document.getElementById('aliqInternaTexto').innerText = `Alíquota Interna: ${aliqInterna.toFixed(2)}%`;
      document.getElementById('diferencaAliqTexto').innerText = `Diferença entre Alíquotas: ${diferencaAliq.toFixed(2)}%`;
      document.getElementById('baseCalculoTexto').innerText = `Base de Cálculo DIFAL: R$ ${baseCalculo.toFixed(2)}`;
      document.getElementById('valorDIFALTexto').innerText = `DIFAL Calculado: R$ ${difal.toFixed(2)}`;
      document.getElementById('valorFCPTexto').innerText = fcp > 0 ? `Valor do FCP: R$ ${fcp.toFixed(2)}` : '';
      document.getElementById('resultado').classList.remove('hidden');
    }
  </script>
</body>
</html>
